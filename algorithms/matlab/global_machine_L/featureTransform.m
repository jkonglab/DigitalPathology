function [trgtMatched, refMatched] = featureTransform(trgt, ref, result_file, target_order_id, correctTF)    %FEATURETRANSFORM Computes feature-based transformation matrix for two    %images    %   This function performs global feature-based registration on a target    %   and reference image    %% Check Input    %read in trgt if not an image    if ischar(trgt)        trgtIm = imread(trgt);    elseif ismatrix(trgt)        trgtIm = trgt;        clear trgt;    else        error('trgt is neither an image nor a file path');    end    %read in ref if not an image    if ischar(ref)        refIm = imread(ref);    elseif ismatrix(ref)        refIm = ref;        clear ref;    else        error('ref is neither an image nor a file path');    end        %% Convert RGB to Grayscale    refIm = rgb2gray(refIm);    trgtIm = rgb2gray(trgtIm);     %alternative conversion to gray    %     refIm = imabsdiff(refIm(:,:,2),refIm(:,:,3));    %     trgtIm = imabsdiff(trgtIm(:,:,2),transIm(:,:,3));    %% Detect Features    %detect image features with built-in SURF function    refPts  = detectSURFFeatures(refIm);    transPts = detectSURFFeatures(trgtIm);    %extract image features    [refFeatures, refValidPts]  = extractFeatures(refIm,  refPts);    [trgtFeatures, transValidPts]  = extractFeatures(trgtIm, transPts);    %match image features between ref and trans    indexPairs = matchFeatures(refFeatures, trgtFeatures);    refMatched  = refValidPts(indexPairs(:,1));    trgtMatched = transValidPts(indexPairs(:,2));        if ~correctTF        for i = 1:refMatched.Count            dlmwrite(result_file, [target_order_id, trgtMatched.Location(i,:), target_order_id+1, refMatched.Location(i,:)], '-append');        end    end    %save refMatched, trgtMatched to DB    %show low resolution images associated with level    %feed point coordinates to DP for web visualization and point tuning by users    %After users finish changing points on DP web, continue from here    % compute tranformation matrix    %[tmatrix, ~, ~] = estimateGeometricTransform(trgtMatched, refMatched, 'similarity');end