<div class="bmd-layout-container bmd-drawer-f-l bmd-drawer-in">
	<div id="dw-1" class="bmd-layout-drawer bg-faded" aria-expanded="false" aria-hidden="false">
		<div class="drawer-tab active drawer-home">
			<%= render partial: "drawer_home", locals: { image: @image } %>
		</div>
		<div class="drawer-tab drawer-annotations">
			<%= render partial: "drawer_annotations", locals: { annotation: @annotation, image: @image } %>
		</div>
		<div class="drawer-tab drawer-data">
			<%= render partial: "drawer_data", locals: { image_json: @image_json, image: @image } %>
		</div>
    </div>

    <div class="bmd-layout-content">
		<div class="row">
			<div class="col-12">
				<div id="<%=@image.upload_file_name.parameterize%>" class="openseadragon">
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	var viewer = OpenSeadragon({
	    id:            "<%=@image.upload_file_name.parameterize%>",
	    prefixUrl:     "/openseadragon/images/",
	    tileSources:   "https://s3.amazonaws.com/<%=Rails.application.config.s3_bucket%>/<%=@image.upload_file_name.split('.svs')[0]%>/<%=@image.upload_file_name.split('.svs')[0]%>.dzi",
	});

	viewer.initializeAnnotations();

	$( "#new_annotation" ).submit(function( event ) {
	  var annotation_data = viewer.annotations.get();
	  $('#annotation_data').val(JSON.stringify(annotation_data));
	});

	$('.annotation-row').click(function(){
		var annotation_data = JSON.parse($(this).attr('annotation-data'));
		viewer.annotations.set(annotation_data);
	})

	$('.drawer-link').click(function(){
		var clicked_tab = $(this).attr('data-tab');
		$('.drawer-tab').removeClass('active');
		$('.'+clicked_tab).css('opacity',0).addClass('active').animate({opacity: 1}, 50);
		if(clicked_tab == 'drawer-annotations'){
			viewer.startDrawing();
		}else{
			viewer.stopDrawing();
		}
	})
</script>

<div id="general-modal" class="modal fade" role="dialog">
	<div class="modal-dialog">
   		<div class="modal-content">
     		<div class="modal-header">
       			<button type="button" class="close" data-dismiss="modal">&times;</button>
      			<h4 id="general-modal-title" class="modal-title"></h4>
     		</div>
    		<div class="modal-body">
				<div class="md-form" style="margin-right: 0">
					<input type="hidden" id="quick_input_field_key" class="form-control">
		   			<input type="text" id="quick_input_field" class="form-control">
				</div>
    		</div>
    		<div class="modal-footer">
		       	<button onclick="submitData()" class="btn btn-primary">Submit</button>
		    </div>
    	</div>
    </div>
</div>

